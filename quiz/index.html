<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Montreal Mayor's Alignment Quiz</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f6;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #007bff;
            margin-bottom: 30px;
        }
        .question-block {
            border: 1px solid #ddd;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 8px;
            background-color: #f9f9f9;
            transition: box-shadow 0.3s;
        }
        .question-block:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        .question-text {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        .controls-group {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background-color: #fff;
        }
        .controls-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }
        .radio-group {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        .radio-group input[type="radio"] {
            display: none;
        }
        .radio-group label {
            flex-grow: 1;
            text-align: center;
            padding: 8px 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            margin: 3px;
            transition: background-color 0.2s, border-color 0.2s;
            font-size: 0.9em;
            font-weight: normal;
        }
        .radio-group input[type="radio"]:checked + label {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        .importance-slider {
            width: 100%;
            margin-top: 10px;
        }
        .importance-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: #777;
            margin-top: 5px;
        }
        #results-container {
            margin-top: 40px;
            padding: 25px;
            border: 2px solid #28a745;
            border-radius: 10px;
            background-color: #e9f7eb;
            display: none; /* Hidden initially */
        }
        #results-container h2 {
            color: #28a745;
            text-align: center;
        }
        .result-bar {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .candidate-name {
            width: 150px;
            font-weight: bold;
        }
        .bar-wrapper {
            flex-grow: 1;
            height: 25px;
            background: #e9ecef;
            border-radius: 5px;
            margin-right: 10px;
            overflow: hidden;
        }
        .bar-fill {
            height: 100%;
            background-color: #007bff;
            transition: width 1s ease-out;
            display: flex;
            align-items: center;
            padding-left: 10px;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }
        .result-percent {
            width: 50px;
            text-align: right;
            font-weight: bold;
        }
        #calculate-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #28a745;
            color: white;
            font-size: 1.2em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 30px;
            transition: background-color 0.3s;
        }
        #calculate-btn:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Montreal Mayor's Alignment Quiz</h1>
        <p>Select your level of agreement for each statement and then rate its importance to you. Click "Calculate" at the end!</p>

        <form id="quiz-form">
            </form>

        <button id="calculate-btn">Calculate My Alignment</button>

        <div id="results-container">
            <h2>Your Best Match!</h2>
            <div id="results-output">
                </div>
            <p style="margin-top: 20px; font-size: 0.9em; color: #555; text-align: center;">*Scores are based on weighted alignment with each candidate's platform.</p>
        </div>
    </div>

    <script>
        // JavaScript content will go here
    </script>
</body>
</html>
```

## 2\. JavaScript (`<script>` tag content in `index.html`)

The following JavaScript must be placed inside the `<script>` tag at the bottom of the `index.html` body.

```javascript
// --- Data Setup ---

// Scoring Scale: SD=-2, D=-1, N=0, A=1, SA=2
const SCORE_SCALE = {
    'SD': -2,
    'D': -1,
    'N': 0,
    'A': 1,
    'SA': 2
};

// Candidate data: Key is the candidate, Value is an array of their scores for Q1 to Q16
const CANDIDATE_SCORES = {
    'Luc Rabouin (Projet Montréal)': [2, -2, 1, -1, -1, -2, 1, -1, -1, -2, 1, 1, -1, -1, -2, 1],
    'Soraya Martinez Ferrada (Ensemble Montréal)': [-1, -1, 1, -1, -2, -1, 1, -2, -1, -2, 1, -1, 1, -2, -1, -2],
    'Craig Sauvé (Transition Montréal)': [2, -2, -1, 2, 2, -2, 2, 2, 2, 2, 2, 2, 2, 2, -2, 2],
    'Gilbert Thibodeau (Action Montréal)': [-2, 2, 2, -2, 0, 2, -1, -2, -2, -1, 1, -1, 2, -2, 2, -2],
    'Jean-François Kacou (Futur Montréal)': [-2, 2, 0, -1, 0, -1, -1, 0, 1, -1, 0, -1, 1, -1, -1, -2]
};

// Quiz Questions and their canonical score mapping
// The question array uses the index (0-15) to match the CANDIDATE_SCORES array
const QUESTIONS = [
    { id: 1, text: "The city must **immediately expand the Réseau express vélo (REV)**, adding specialized options like Bixi baby seats and rapid bus lanes on major arteries." },
    { id: 2, text: "I support **banning any new bike lanes on commercial streets** and removing existing lanes that eliminate essential parking spots for businesses." },
    { id: 3, text: "The city must commit to **weekly garbage collection in all boroughs** year-round, even if it means raising the frequency to twice a week in the summer." },
    { id: 4, text: "To fight climate change, I support implementing a **kilometre tax on vehicle use** and planting 50,000 trees to eliminate heat islands by 2032." },
    { id: 5, text: "The municipal public transit discount currently offered to students should be extended to **all low-income residents** earning less than $\\mathbf{\$47,500}$." },
    { id: 6, text: "Residential parking permits should be capped at $\\mathbf{\$50}$ per year, and parking meters should be **free all weekend** (Friday 9 PM to Monday 9 AM)." },
    { id: 7, text: "The city should designate a **Night Mayor and Night Council** to act as a mediator for noise complaints, reducing police involvement in cultural venue issues." },
    { id: 8, text: "Montreal's electoral system must be reformed by introducing a **preferential ballot** for mayoral races and a single transferable vote for other positions." },
    { id: 9, text: "I support introducing a **new municipal tax on individual residential properties valued over $\\mathbf{\$3.5}$ million** to fund anti-gentrification and homelessness efforts." },
    { id: 10, text: "For homelessness, the city should **declare a state of emergency** to requisition hotels and vacant buildings, and ban police from intervening in large encampments." },
    { id: 11, text: "The city must **eliminate the current affordable housing bylaw** and replace it with a system that focuses on creating a large-scale public/community housing corporation." },
    { id: 12, text: "I support a **complete moratorium (total ban)** on all short-term rentals (like Airbnb) in residential units to preserve the housing stock for families." },
    { id: 13, text: "The city's top transit priority should be **Metro extensions** (Orange line to Bois-Franc, Green line to Lachine), not the construction of new tramway lines." },
    { id: 14, text: "The city should redirect $\\mathbf{\$25}$ million from the police budget (like overtime) to **prevention and new civilian services** to address non-urgent social issues." },
    { id: 15, text: "To ensure safety and secularism, I support a strong police crackdown on unruly protests and the requirement of a **permit for any religious event** in a public space." },
    { id: 16, text: "Montreal should take a clear stance on the Israel-Gaza conflict by officially calling for an **arms embargo on Israel** and supporting **divestment from genocide**." }
];


// --- Helper Functions ---

/**
 * Calculates the agreement score for one question.
 * The formula is: (5 - |User Score - Candidate Score|) * Importance Multiplier
 * Max agreement (5 - 0) * 5 = 25. Min agreement (5 - 4) * 1 = 1.
 * @param {number} userScore - The user's score for the question (-2 to 2).
 * @param {number} candidateScore - The candidate's canonical score for the question (-2 to 2).
 * @param {number} importance - The user's importance rating (1 to 5).
 * @returns {number} The weighted agreement score.
 */
function calculateAgreement(userScore, candidateScore, importance) {
    const scoreDifference = Math.abs(userScore - candidateScore);
    // scoreDifference will be between 0 (perfect match) and 4 (max disagreement: 2 vs -2)
    // Agreement is 5 - scoreDifference (5 for max match, 1 for min match)
    const rawAgreement = 5 - scoreDifference;
    return rawAgreement * importance;
}

// --- Main Logic ---

/**
 * Renders the quiz questions to the form.
 */
function renderQuiz() {
    const form = document.getElementById('quiz-form');
    let html = '';

    QUESTIONS.forEach(q => {
        html += `
            <div class="question-block" data-question-id="${q.id}">
                <div class="question-text">${q.id}. ${q.text}</div>

                <div class="controls-group">
                    <label>Your Agreement:</label>
                    <div class="radio-group">
                        <input type="radio" id="q${q.id}-sd" name="agreement-${q.id}" value="-2" required><label for="q${q.id}-sd">Strongly Disagree</label>
                        <input type="radio" id="q${q.id}-d" name="agreement-${q.id}" value="-1"><label for="q${q.id}-d">Disagree</label>
                        <input type="radio" id="q${q.id}-n" name="agreement-${q.id}" value="0"><label for="q${q.id}-n">Neutral</label>
                        <input type="radio" id="q${q.id}-a" name="agreement-${q.id}" value="1"><label for="q${q.id}-a">Agree</label>
                        <input type="radio" id="q${q.id}-sa" name="agreement-${q.id}" value="2"><label for="q${q.id}-sa">Strongly Agree</label>
                    </div>
                </div>

                <div class="controls-group">
                    <label>Importance (Multiplier):</label>
                    <input type="range" id="importance-${q.id}" name="importance-${q.id}" min="1" max="5" value="3" class="importance-slider">
                    <div class="importance-label">
                        <span>1 (Low)</span>
                        <span>5 (High)</span>
                    </div>
                </div>
            </div>
        `;
    });

    form.innerHTML = html;
}

/**
 * Calculates the final results and displays them.
 */
function calculateResults() {
    const form = document.getElementById('quiz-form');
    const formData = new FormData(form);
    const results = {};
    const maxScore = 5 * 5 * 16; // Max agreement (5) * Max importance (5) * 16 questions

    // Initialize candidate scores
    for (const candidate in CANDIDATE_SCORES) {
        results[candidate] = 0;
    }

    // Process all questions
    for (let i = 0; i < QUESTIONS.length; i++) {
        const qId = QUESTIONS[i].id;
        
        // Retrieve user inputs
        const userAgreement = formData.get(`agreement-${qId}`);
        const userImportance = formData.get(`importance-${qId}`);

        // Check if all questions have been answered
        if (userAgreement === null || userImportance === null) {
            alert(`Please answer Question ${qId} and set its importance.`);
            return; // Stop calculation
        }

        const userScore = parseInt(userAgreement);
        const importanceMultiplier = parseInt(userImportance);

        // Calculate weighted agreement for each candidate
        let candidateIndex = 0;
        for (const candidate in CANDIDATE_SCORES) {
            const candidateScore = CANDIDATE_SCORES[candidate][i];
            const agreementScore = calculateAgreement(userScore, candidateScore, importanceMultiplier);
            results[candidate] += agreementScore;
            candidateIndex++;
        }
    }

    // Calculate percentage alignment
    const finalResults = [];
    for (const candidate in results) {
        const score = results[candidate];
        const percentage = (score / maxScore) * 100;
        finalResults.push({
            name: candidate.replace(/ \(.*\)/, ''), // Remove party name for clean display
            party: candidate.match(/\(([^)]+)\)/)[1], // Extract party name
            score: score,
            percentage: parseFloat(percentage.toFixed(1))
        });
    }

    // Sort by percentage (highest first)
    finalResults.sort((a, b) => b.percentage - a.percentage);

    // Render results
    renderResults(finalResults);
}

/**
 * Renders the final results as percentage bars.
 * @param {Array<Object>} results - The calculated and sorted results.
 */
function renderResults(results) {
    const outputDiv = document.getElementById('results-output');
    const resultsContainer = document.getElementById('results-container');
    let html = '';

    results.forEach(r => {
        html += `
            <div class="result-bar">
                <div class="candidate-name">${r.name} (${r.party})</div>
                <div class="bar-wrapper">
                    <div class="bar-fill" style="width: ${r.percentage}%;">
                    </div>
                </div>
                <div class="result-percent">${r.percentage}%</div>
            </div>
        `;
    });

    outputDiv.innerHTML = html;
    resultsContainer.style.display = 'block';

    // Scroll to the results
    resultsContainer.scrollIntoView({ behavior: 'smooth' });
}


// --- Event Listeners and Initialization ---

document.addEventListener('DOMContentLoaded', () => {
    renderQuiz();

    document.getElementById('calculate-btn').addEventListener('click', (event) => {
        event.preventDefault(); // Prevent form submission
        calculateResults();
    });
});
```
