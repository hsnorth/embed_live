<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The News Haul</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
</head>
<body>

    <nav class="mobile-nav" aria-hidden="true">
        <div class="mobile-nav-header">
            <button class="close-menu-btn" aria-label="Close menu">
                &times;
            </button>
            <a href="#" class="mobile-nav-logo">THE NEWS HAUL.</a>
        </div>
        <ul class="mobile-nav-links">
            <li>
                <a href="#">
                    Latest Issue
                    <span class="sub-link">Montreal #3</span>
                </a>
            </li>
            <li>
                <a href="#" class="has-arrow">
                    Past Issues
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                </a>
            </li>
        </ul>
        <hr class="mobile-nav-divider">
        <ul class="mobile-nav-links secondary-links">
            <li><a href="#">How the Haul works</a></li>
            <li><a href="#">About Us</a></li>
            <li><a href="#">Contact Us</a></li>
        </ul>
    </nav>

    <header class="main-header">
        <div class="header-top-bar">
            <div class="top-bar-left">
                <button class="menu-toggle" aria-label="Open menu">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
                <a href="#" class="nav-link how-it-works">HOW THE HAUL WORKS?</a>
            </div>

            <a href="#" class="scrolled-logo-link">THE NEWS HAUL.</a>

            <div class="user-actions">
                <a href="#" class="search-icon desktop-only" aria-label="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </a>
                <div class="desktop-only user-auth-links">
                    <a href="#" class="nav-link">SIGN IN</a>
                    <a href="#" class="btn btn-primary">JOIN COMMUNITY</a>
                </div>
                <a href="#" class="mobile-only-icon" aria-label="Cart">
                    <img src="bag.png" alt="Shopping bag icon">
                </a>
            </div>
        </div>

        <div class="header-branding">
            <div class="branding-col branding-col-left">
                <img src="env.png" alt="Envelope icon" class="branding-icon env-icon">
            </div>
            <div class="branding-col branding-col-center">
                <h1 class="logo">The News Haul</h1>
                <p class="header-date">Tuesday, Sept. 16, 2025</p>
            </div>
            <div class="branding-col branding-col-right">
                <img src="bag.png" alt="Bag icon" class="branding-icon">
            </div>
        </div>
        
        <nav class="main-nav">
            <ul>
                <li><a href="#" class="active-link">Welcome</a></li>
                <li><a href="#">Essentials</a></li>
                <li><a href="#">Imports</a></li>
                <li><a href="#">Next deliveries</a></li>
                <li><a href="#">Cannoli</a></li>
                <li><a href="#">Coffee Review</a></li>
                <li><a href="#">Games</a></li>
            </ul>
        </nav>
    </header>

    <main class="content-wrapper">
        <article class="main-article">
            <div class="eyebrow-container">
                <img src="harrygraphic2.png" alt="Harry's Icon" class="harry-icon">
                <span class="eyebrow">Harry's Note</span>
            </div>
            <h2 class="article-title">How is Montreal doing this week? Don't bloody ask.</h2>
            <p>It’s not always easy being rich – just ask Norway’s prime minister. Following re-election last week, Jonas Gahr Støre holds the nation’s purse strings as a cast of competitive coalition partners and critics from...</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Dictum non consectetur a erat nam at lectus. Ultricies mi quis hendrit dolor magna. Massa tempor nec feugiat nisl pretium fusce id velit ut. Sed libero enim sed faucibus turpis in eu mi. Facilisi nullam vehicula ipsum a arcu cursus vitae congue. Accumsan lacus vel facilisis volutpat est velit egestas dui. Velit laoreet id donec ultrices tincidunt arcu non sodales. Viverra justo nec ultrices dui sapien eget mi proin. Id diam vel quam elementum pulvinar etiam non quam lacus.</p>
        </article>

        <div class="third-column">
            <div class="article-preview">
                <img src="sweet.png" alt="A sweet cannoli" class="preview-image">
                <span class="eyebrow">The Cannoli</span>
                <h3 class="preview-title"><a href="#">Arrow error: When resurfacing crews sent traffic into itself</a></h3>
            </div>
            <div class="article-preview">
                <span class="eyebrow">The Coffee</span>
                <h3 class="preview-title"><a href="#">In the Plateau, Café Tere</a></h3>
            </div>
        </div>

        <aside class="sidebar-container">
            <div class="sidebar">
                <h3 class="sidebar-title">Montreal Issue #3</h3>
                <div class="sidebar-content">
                    <div class="sidebar-item">
                        <div class="item-thumbnail"></div>
                        <div class="item-text">
                            <h4>The Essentials</h4>
                            <p>A weekly roundup of must-have items and gear.</p>
                        </div>
                    </div>
                    <div class="sidebar-item">
                        <div class="item-thumbnail"></div>
                        <div class="item-text">
                            <h4>The Imports</h4>
                            <p>Discover new finds from around the globe.</p>
                        </div>
                    </div>
                    <div class="sidebar-item">
                        <div class="item-thumbnail"></div>
                        <div class="item-text">
                            <h4>Next Deliveries</h4>
                            <p>What's new and what's coming to our shop next.</p>
                        </div>
                    </div>
                </div>
                <div class="issue-intel">
                    <h4>Issue Intel</h4>
                    <p>7 min read</p>
                    <p>1,300 words</p>
                </div>
            </div>
        </aside>
    </main>
    
    <script>
        // --- Setup constants for DOM elements ---
        const header = document.querySelector('.main-header');
        const headerBranding = document.querySelector('.header-branding');
        const menuToggle = document.querySelector('.menu-toggle');
        const mobileNav = document.querySelector('.mobile-nav');
        const closeMenuBtn = document.querySelector('.close-menu-btn');

        // --- Script for header scrolling effect ---
        window.addEventListener('scroll', () => {
            const scrollThreshold = headerBranding.offsetHeight;
            if (window.scrollY > scrollThreshold) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });

        // --- Script for mobile menu toggle ---
        function toggleMenu() {
            const isOpen = mobileNav.classList.toggle('is-open');
            mobileNav.setAttribute('aria-hidden', !isOpen);
            document.body.classList.toggle('no-scroll', isOpen);
        }

        menuToggle.addEventListener('click', toggleMenu);
        closeMenuBtn.addEventListener('click', toggleMenu);
    </script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBgCds3FfTRZtZaAQ0Ej6hfgPPMqeRy54s",
            authDomain: "newsletter-496de.firebaseapp.com",
            projectId: "newsletter-496de",
            storageBucket: "newsletter-496de.appspot.com",
            messagingSenderId: "524546319756",
            appId: "1:524546319756:web:947abcff220aec51aa22a9",
            measurementId: "G-B8LSKDYS99"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        console.log("Firebase v9 is connected!");

        // --- AUTHENTICATION FUNCTIONS ---

        // Function to handle new user sign-ups
        // TODO: Call this function when your "Join" form is submitted
        const signUp = async (email, password) => {
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                console.log('Successfully signed up!', user);

                // Save user info to a 'users' collection in Firestore
                await setDoc(doc(db, "users", user.uid), {
                    email: user.email,
                    createdAt: serverTimestamp()
                });
                console.log('User data saved to Firestore.');
                
            } catch (error) {
                console.error('Error during sign up:', error.message);
                alert('Error: ' + error.message);
            }
        };

        // Function to handle user sign-ins
        // TODO: Call this function when your "Sign In" form is submitted
        const signIn = async (email, password) => {
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                console.log('Successfully signed in!', userCredential.user);

            } catch (error) {
                console.error('Error during sign in:', error.message);
                alert('Error: ' + error.message);
            }
        };

        // Function to handle user sign-outs
        const handleSignOut = async () => {
            try {
                await signOut(auth);
                console.log('User signed out.');
            } catch (error) {
                console.error('Sign out error:', error);
            }
        };

        // --- AUTH STATE LISTENER ---
        // This runs automatically when the page loads and whenever the user's login state changes
        onAuthStateChanged(auth, (user) => {
            const userAuthLinks = document.querySelector('.user-auth-links');
            if (!userAuthLinks) return;

            if (user) {
                // User is signed in.
                console.log('User is logged in:', user);
                // Update the UI to show a "Sign Out" button
                userAuthLinks.innerHTML = `<a href="#" class="btn" id="signOutBtn">SIGN OUT</a>`;
                document.getElementById('signOutBtn').addEventListener('click', (e) => {
                    e.preventDefault();
                    handleSignOut();
                });
                
                // Optional: Fetch and log the user's profile data
                getUserProfile(user.uid);

            } else {
                // User is signed out.
                console.log('User is logged out.');
                // Revert UI back to the original Sign In / Join buttons
                userAuthLinks.innerHTML = `
                    <a href="#" class="nav-link" id="signInLink">SIGN IN</a>
                    <a href="#" class="btn btn-primary" id="joinLink">JOIN COMMUNITY</a>
                `;
                // TODO: Add event listeners to signInLink and joinLink to open your modals/forms
            }
        });

        // --- FIRESTORE DATA EXAMPLE ---
        // Example of how to read a user's profile data
        const getUserProfile = async (userId) => {
            if (!userId) return null;

            const userDocRef = doc(db, 'users', userId);
            const docSnap = await getDoc(userDocRef);

            if (docSnap.exists()) {
                console.log("User profile data:", docSnap.data());
                return docSnap.data();
            } else {
                console.log("No such user document!");
                return null;
            }
        };
    </script>

</body>
</html>
