<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The News Haul</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
</head>
<body>

    <nav class="mobile-nav" aria-hidden="true">
        <div class="mobile-nav-header">
            <button class="close-menu-btn" aria-label="Close menu">
                &times;
            </button>
            <a href="#" class="mobile-nav-logo">THE NEWS HAUL.</a>
        </div>
        <ul class="mobile-nav-links">
            <li>
                <a href="#">
                    Latest Issue
                    <span class="sub-link">Montreal #3</span>
                </a>
            </li>
            <li>
                <a href="#" class="has-arrow">
                    Past Issues
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                </a>
            </li>
        </ul>
        <hr class="mobile-nav-divider">
        <ul class="mobile-nav-links secondary-links">
            <li><a href="#">How the Haul works</a></li>
            <li><a href="#">About Us</a></li>
            <li><a href="#">Contact Us</a></li>
        </ul>
    </nav>

    <header class="main-header">
        <div class="header-top-bar">
            <div class="top-bar-left">
                <button class="menu-toggle" aria-label="Open menu">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
                <a href="#" class="nav-link how-it-works">HOW THE HAUL WORKS?</a>
            </div>

            <a href="#" class="scrolled-logo-link">THE NEWS HAUL.</a>

            <div class="user-actions">
                <a href="#" class="search-icon desktop-only" aria-label="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </a>
                
                <div class="desktop-only user-auth-links">
                    <a href="#" class="nav-link" id="signInLink">SIGN IN</a>
                    <a href="#" class="btn btn-primary" id="joinLink">JOIN COMMUNITY</a>
                </div>

                <a href="#" class="mobile-only-icon" aria-label="Cart">
                    <img src="bag.png" alt="Shopping bag icon">
                </a>
            </div>
        </div>

        <div class="header-branding">
            <div class="branding-col branding-col-left">
                <img src="env.png" alt="Envelope icon" class="branding-icon env-icon">
            </div>
            <div class="branding-col branding-col-center">
                <h1 class="logo">The News Haul</h1>
                <p class="header-date">Tuesday, Sept. 19, 2025</p>
            </div>
            <div class="branding-col branding-col-right">
                <img src="bag.png" alt="Bag icon" class="branding-icon">
            </div>
        </div>
        
        <nav class="main-nav">
            <ul>
                <li><a href="#" class="active-link">Welcome</a></li>
                <li><a href="#">Essentials</a></li>
                <li><a href="#">Imports</a></li>
                <li><a href="#">Next deliveries</a></li>
                <li><a href="#">Cannoli</a></li>
                <li><a href="#">Coffee Review</a></li>
                <li><a href="#">Games</a></li>
            </ul>
        </nav>
    </header>

    <main class="content-wrapper">
        <article class="main-article">
            <div class="eyebrow-container">
                <img src="harrygraphic2.png" alt="Harry's Icon" class="harry-icon">
                <span class="eyebrow">Harry's Note</span>
            </div>
            <h2 class="article-title">How is Montreal doing this week? Don't bloody ask.</h2>
            <p>It’s not always easy being rich – just ask Norway’s prime minister. Following re-election last week, Jonas Gahr Støre holds the nation’s purse strings as a cast of competitive coalition partners and critics from...</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Dictum non consectetur a erat nam at lectus. Ultricies mi quis hendrit dolor magna. Massa tempor nec feugiat nisl pretium fusce id velit ut. Sed libero enim sed faucibus turpis in eu mi. Facilisi nullam vehicula ipsum a arcu cursus vitae congue. Accumsan lacus vel facilisis volutpat est velit egestas dui. Velit laoreet id donec ultrices tincidunt arcu non sodales. Viverra justo nec ultrices dui sapien eget mi proin. Id diam vel quam elementum pulvinar etiam non quam lacus.</p>
        </article>

        <div class="third-column">
            <div class="article-preview">
                <img src="sweet.png" alt="A sweet cannoli" class="preview-image">
                <span class="eyebrow">The Cannoli</span>
                <h3 class="preview-title"><a href="#">Arrow error: When resurfacing crews sent traffic into itself</a></h3>
            </div>
            <div class="article-preview">
                <span class="eyebrow">The Coffee</span>
                <h3 class="preview-title"><a href="#">In the Plateau, Café Tere</a></h3>
            </div>
        </div>

        <aside class="sidebar-container">
            <div class="sidebar">
                <h3 class="sidebar-title">Montreal Issue #3</h3>
                <div class="sidebar-content">
                    <div class="sidebar-item">
                        <div class="item-thumbnail"></div>
                        <div class="item-text">
                            <h4>The Essentials</h4>
                            <p>A weekly roundup of must-have items and gear.</p>
                        </div>
                    </div>
                    <div class="sidebar-item">
                        <div class="item-thumbnail"></div>
                        <div class="item-text">
                            <h4>The Imports</h4>
                            <p>Discover new finds from around the globe.</p>
                        </div>
                    </div>
                    <div class="sidebar-item">
                        <div class="item-thumbnail"></div>
                        <div class="item-text">
                            <h4>Next Deliveries</h4>
                            <p>What's new and what's coming to our shop next.</p>
                        </div>
                    </div>
                </div>
                <div class="issue-intel">
                    <h4>Issue Intel</h4>
                    <p>7 min read</p>
                    <p>1,300 words</p>
                </div>
            </div>
        </aside>
    </main>
    
    <div id="signInModal" class="modal-overlay" aria-hidden="true">
        <div class="modal-content subscription-card">
            <button class="modal-close-btn">&times;</button>
            <h3 class="modal-header-text">SIGN IN</h3>
            <form id="signInForm" class="modal-form">
                <label for="signInEmail" class="form-label">EMAIL</label>
                <input type="email" id="signInEmail" class="form-input" placeholder="Enter your email" required>

                <label for="signInPassword" class="form-label">PASSWORD</label>
                <input type="password" id="signInPassword" class="form-input" placeholder="Enter your password" required>

                <button type="submit" class="modal-btn">SIGN IN</button>
            </form>
            <div class="modal-links">
                <button id="forgotPasswordBtn" class="modal-link-btn">Forgot password?</button>
                <button id="goToJoinBtnFromSignIn" class="modal-link-btn">Don't have an account? Join Community</button>
            </div>
        </div>
    </div>

    <div id="joinModal" class="modal-overlay" aria-hidden="true">
        <div class="modal-content subscription-card">
            <button class="modal-close-btn">&times;</button>
            
            <h2 id="modalTagline" class="modal-tagline"></h2>
            
            <form id="joinFormStep1" class="modal-form" data-step="1">
                <label for="joinEmail" class="form-label">EMAIL</label>
                <input type="email" id="joinEmail" class="form-input" placeholder="Enter your email" required>
                <button type="submit" class="modal-btn">NEXT</button>
            </form>

            <form id="joinFormStep2" class="modal-form hidden" data-step="2">
                <label for="joinName" class="form-label">NAME</label>
                <input type="text" id="joinName" class="form-input" placeholder="Enter your name" required>

                <label for="joinPassword" class="form-label">PASSWORD</label>
                <input type="password" id="joinPassword" class="form-input" placeholder="Create a password" required>

                <button type="submit" class="modal-btn">JOIN</button>
            </form>

            <div class="modal-links">
                <button id="goToSignInBtnFromJoin" class="modal-link-btn">Already have an account? Sign In</button>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <script>
        // --- Setup constants for DOM elements ---
        const header = document.querySelector('.main-header');
        const headerBranding = document.querySelector('.header-branding');
        const menuToggle = document.querySelector('.menu-toggle');
        const mobileNav = document.querySelector('.mobile-nav');
        const closeMenuBtn = document.querySelector('.close-menu-btn');

        // --- Script for header scrolling effect ---
        window.addEventListener('scroll', () => {
            const scrollThreshold = headerBranding.offsetHeight;
            if (window.scrollY > scrollThreshold) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });

        // --- Script for mobile menu toggle ---
        function toggleMenu() {
            const isOpen = mobileNav.classList.toggle('is-open');
            mobileNav.setAttribute('aria-hidden', !isOpen);
            document.body.classList.toggle('no-scroll', isOpen);
        }

        menuToggle.addEventListener('click', toggleMenu);
        closeMenuBtn.addEventListener('click', toggleMenu);
    </script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBgCds3FfTRZtZaAQ0Ej6hfgPPMqeRy54s",
            authDomain: "newsletter-496de.firebaseapp.com",
            projectId: "newsletter-496de",
            storageBucket: "newsletter-496de.appspot.com",
            messagingSenderId: "524546319756",
            appId: "1:524546319756:web:947abcff220aec51aa22a9",
            measurementId: "G-B8LSKDYS99"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        console.log("Firebase v9 is connected!");

        // --- DOM ELEMENTS ---
        const signInModal = document.getElementById('signInModal');
        const joinModal = document.getElementById('joinModal');
        const modalCloseBtns = document.querySelectorAll('.modal-close-btn');
        const joinFormStep1 = document.getElementById('joinFormStep1');
        const joinFormStep2 = document.getElementById('joinFormStep2');
        const signInForm = document.getElementById('signInForm');
        const forgotPasswordBtn = document.getElementById('forgotPasswordBtn');
        const goToJoinBtnFromSignIn = document.getElementById('goToJoinBtnFromSignIn');
        const goToSignInBtnFromJoin = document.getElementById('goToSignInBtnFromJoin');
        const modalTagline = document.getElementById('modalTagline');
        const toastContainer = document.getElementById('toast-container');
        let typeInterval;
        let joinEmailValue = '';

        // --- NEW: CUSTOM NOTIFICATION FUNCTION ---
        function showToast(message, type = 'info', duration = 4000) {
            const toast = document.createElement('div');
            toast.classList.add('toast', `toast-${type}`);
            toast.textContent = message;

            toastContainer.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('toast-exit');
                toast.addEventListener('animationend', () => {
                    toast.remove();
                });
            }, duration);
        }

        // --- TYPEWRITER EFFECT FUNCTION ---
        function typewriterEffect(element, text, speed, callback) {
            let i = 0;
            element.innerHTML = '';
            element.classList.add('typing-active');
            if (typeInterval) clearInterval(typeInterval);
            typeInterval = setInterval(() => {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                } else {
                    clearInterval(typeInterval);
                    element.classList.remove('typing-active');
                    if (callback) callback();
                }
            }, speed);
        }

        // --- MODAL FUNCTIONS ---
        function openModal(modal) {
            modal.setAttribute('aria-hidden', 'false');
            modal.classList.add('is-open');
            document.body.classList.add('no-scroll');
            if (modal.id === 'joinModal') {
                const textToType = "For stories to tell at supper";
                setTimeout(() => {
                    typewriterEffect(modalTagline, textToType, 80, () => {
                        joinFormStep1.classList.add('form-visible');
                    });
                }, 300);
            }
        }

        function closeModal(modal) {
            modal.setAttribute('aria-hidden', 'true');
            modal.classList.remove('is-open');
            document.body.classList.remove('no-scroll');
            joinFormStep1.classList.remove('hidden');
            joinFormStep2.classList.add('hidden');
            joinFormStep1.reset();
            joinFormStep2.reset();
            if (typeInterval) clearInterval(typeInterval);
            if (modalTagline) {
                modalTagline.innerHTML = '';
                modalTagline.classList.remove('typing-active');
            }
            joinFormStep1.classList.remove('form-visible');
        }

        // --- EVENT LISTENERS ---
        modalCloseBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const modalToClose = e.target.closest('.modal-overlay');
                if (modalToClose) closeModal(modalToClose);
            });
        });
        signInModal.addEventListener('click', (e) => {
            if (e.target === signInModal) closeModal(signInModal);
        });
        joinModal.addEventListener('click', (e) => {
            if (e.target === joinModal) closeModal(joinModal);
        });
        goToJoinBtnFromSignIn.addEventListener('click', (e) => {
            e.preventDefault();
            closeModal(signInModal);
            openModal(joinModal);
        });
        goToSignInBtnFromJoin.addEventListener('click', (e) => {
            e.preventDefault();
            closeModal(joinModal);
            openModal(signInModal);
        });

        // --- AUTHENTICATION FUNCTIONS (UPDATED with showToast) ---
        const signUp = async (email, password, name) => {
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                await setDoc(doc(db, "users", user.uid), {
                    email: user.email,
                    name: name,
                    createdAt: serverTimestamp()
                });
                showToast('Welcome to the community!', 'success');
                closeModal(joinModal);
            } catch (error) {
                showToast(error.message, 'error');
            }
        };

        const signIn = async (email, password) => {
            try {
                await signInWithEmailAndPassword(auth, email, password);
                showToast('Successfully signed in!', 'success');
                closeModal(signInModal);
            } catch (error) {
                showToast(error.message, 'error');
            }
        };

        const handleSignOut = async () => {
            try {
                await signOut(auth);
                showToast('You have been signed out.', 'info');
            } catch (error) {
                showToast(error.message, 'error');
            }
        };

        const handleForgotPassword = async (email) => {
            if (!email) {
                showToast("Please enter an email to reset password.", 'error');
                return;
            }
            try {
                await sendPasswordResetEmail(auth, email);
                showToast("Password reset email sent! Check your inbox.", 'info');
            } catch (error) {
                showToast(error.message, 'error');
            }
        };

        // --- FORM SUBMISSION HANDLERS ---
        signInForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = signInForm.elements['signInEmail'].value;
            const password = signInForm.elements['signInPassword'].value;
            signIn(email, password);
        });
        forgotPasswordBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const email = signInForm.elements['signInEmail'].value;
            handleForgotPassword(email);
        });
        joinFormStep1.addEventListener('submit', (e) => {
            e.preventDefault();
            joinEmailValue = joinFormStep1.elements['joinEmail'].value;
            if (joinEmailValue) {
                joinFormStep1.classList.add('hidden');
                joinFormStep2.classList.remove('hidden');
            }
        });
        joinFormStep2.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = joinFormStep2.elements['joinName'].value;
            const password = joinFormStep2.elements['joinPassword'].value;
            if (joinEmailValue && name && password) {
                signUp(joinEmailValue, password, name);
            } else {
                showToast('Missing name or password.', 'error');
            }
        });

        // --- AUTH STATE LISTENER ---
        onAuthStateChanged(auth, (user) => {
            const userAuthLinks = document.querySelector('.user-auth-links');
            if (!userAuthLinks) return;
            if (user) {
                userAuthLinks.innerHTML = `<a href="#" class="btn" id="signOutBtn">SIGN OUT</a>`;
                document.getElementById('signOutBtn').addEventListener('click', (e) => {
                    e.preventDefault();
                    handleSignOut();
                });
                getUserProfile(user.uid);
                closeModal(signInModal);
                closeModal(joinModal);
            } else {
                userAuthLinks.innerHTML = `
                    <a href="#" class="nav-link" id="signInLink">SIGN IN</a>
                    <a href="#" class="btn btn-primary" id="joinLink">JOIN COMMUNITY</a>
                `;
                document.getElementById('signInLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    closeModal(joinModal);
                    openModal(signInModal);
                });
                document.getElementById('joinLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    closeModal(signInModal);
                    openModal(joinModal);
                });
            }
        });

        // --- FIRESTORE DATA EXAMPLE ---
        const getUserProfile = async (userId) => {
            if (!userId) return null;
            const userDocRef = doc(db, 'users', userId);
            const docSnap = await getDoc(userDocRef);
            if (docSnap.exists()) {
                console.log("User profile data:", docSnap.data());
                return docSnap.data();
            } else {
                console.log("No such user document!");
                return null;
            }
        };
    </script>
</body>
</html>
