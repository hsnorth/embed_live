<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The News Haul</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="mobile-top-bar">
        <a href="#" id="mobileJoinLink">Subscribe</a> | <a href="#" id="mobileSignInLink">Log in</a>
    </div>

    <nav class="mobile-nav" aria-hidden="true">
        <div class="mobile-nav-header">
            <button class="close-menu-btn" aria-label="Close menu">
                &times;
            </button>
            <a href="index.html" class="mobile-nav-logo">THE NEWS HAUL.</a>
        </div>
        <ul class="mobile-nav-links">
            <li>
                <a href="#">
                    Latest Issue
                    <span class="sub-link">Montreal #3</span>
                </a>
            </li>
            <li>
                <a href="#" class="has-arrow">
                    Past Issues
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                </a>
            </li>
        </ul>
        <hr class="mobile-nav-divider">
        <ul class="mobile-nav-links secondary-links">
            <li><a href="how-it-works.html">How the Haul works</a></li>
            <li><a href="about.html">About Us</a></li>
            <li><a href="contact.html">Contact Us</a></li>
        </ul>
    </nav>

    <header class="main-header">
        <div class="header-top-bar">
            <div class="top-bar-left">
                <button class="menu-toggle" aria-label="Open menu">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
                <a href="how-it-works.html" class="nav-link how-it-works">HOW THE HAUL WORKS?</a>
            </div>

            <a href="index.html" class="scrolled-logo-link">THE NEWS HAUL.</a>

            <div class="user-actions">
                <a href="#" class="search-icon desktop-only" aria-label="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </a>
                
                <div class="desktop-only user-auth-links">
                    <a href="#" class="nav-link" id="signInLink">SIGN IN</a>
                    <a href="#" class="btn btn-primary" id="joinLink">JOIN COMMUNITY</a>
                </div>

                <a href="#" class="mobile-only-icon" aria-label="Cart">
                    <img src="bag.png" alt="Shopping bag icon">
                </a>
            </div>
        </div>

        <div class="header-branding">
            <div class="branding-col branding-col-left">
                <img src="env.png" alt="Envelope icon" class="branding-icon env-icon">
            </div>
            <div class="branding-col branding-col-center">
                <h1 class="logo">The News Haul</h1>
                <p class="header-date">Tuesday, Sept. 19, 2025</p>
            </div>
            <div class="branding-col branding-col-right">
                <img src="bag.png" alt="Bag icon" class="branding-icon">
            </div>
        </div>
        
        <nav class="main-nav">
            <ul>
                <li><a href="#welcome" class="active-link">Welcome</a></li>
                <li><a href="#essentials">Essentials</a></li>
                <li><a href="#imports">Imports</a></li>
                <li><a href="#deliveries">Next deliveries</a></li>
                <li><a href="#cannoli">Cannoli</a></li>
                <li><a href="#coffee">Coffee Review</a></li>
                <li><a href="#games">Games</a></li>
            </ul>
        </nav>
    </header>

    <main id="welcome" class="content-wrapper">
        <article class="main-article">
            <div class="eyebrow-container">
                <img src="harrygraphic2.png" alt="Harry's Icon" class="harry-icon">
                <span class="eyebrow">Harry's Note</span>
            </div>
            <h2 class="article-title">How is Montreal doing this week? Don't bloody ask.</h2>
            <p>It’s not always easy being rich – just ask Norway’s prime minister. Following re-election last week, Jonas Gahr Støre holds the nation’s purse strings as a cast of competitive coalition partners and critics from...</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Dictum non consectetur a erat nam at lectus. Ultricies mi quis hendrit dolor magna. Massa tempor nec feugiat nisl pretium fusce id velit ut. Sed libero enim sed faucibus turpis in eu mi. Facilisi nullam vehicula ipsum a arcu cursus vitae congue. Accumsan lacus vel facilisis volutpat est velit egestas dui. Velit laoreet id donec ultrices tincidunt arcu non sodales. Viverra justo nec ultrices dui sapien eget mi proin. Id diam vel quam elementum pulvinar etiam non quam lacus.</p>
        </article>

        <div class="third-column">
            <div class="article-preview">
                <img src="https://placehold.co/600x400/FFF/333?text=Cannoli" alt="A sweet cannoli" class="preview-image">
                <span class="eyebrow">The Cannoli</span>
                <h3 class="preview-title"><a href="#">Arrow error: When resurfacing crews sent traffic into itself</a></h3>
            </div>
            <div class="article-preview">
                <span class="eyebrow">The Coffee</span>
                <h3 class="preview-title"><a href="#">In the Plateau, Café Tere</a></h3>
            </div>
        </div>

        <aside class="sidebar-container">
            <div class="sidebar">
                <h3 class="sidebar-title">Montreal Issue #3</h3>
                <div class="sidebar-content">
                    <div class="sidebar-item">
                        <div class="item-thumbnail"></div>
                        <div class="item-text">
                            <h4>The Essentials</h4>
                            <p>A weekly roundup of must-have items and gear.</p>
                        </div>
                    </div>
                    <div class="sidebar-item">
                        <div class="item-thumbnail"></div>
                        <div class="item-text">
                            <h4>The Imports</h4>
                            <p>Discover new finds from around the globe.</p>
                        </div>
                    </div>
                    <div class="sidebar-item">
                        <div class="item-thumbnail"></div>
                        <div class="item-text">
                            <h4>Next Deliveries</h4>
                            <p>What's new and what's coming to our shop next.</p>
                        </div>
                    </div>
                </div>
                <div class="issue-intel">
                    <h4>Issue Intel</h4>
                    <p>7 min read</p>
                    <p>1,300 words</p>
                </div>
            </div>
        </aside>
    </main>
    
    <section id="essentials" class="content-section">
        <h2 class="section-title">Five essentials</h2>
        <div class="item-grid">
            <div class="grid-item">
                <img src="https://placehold.co/600x400/EEE/333?text=Essential+1" alt="Essential Item 1" class="item-image">
                <span class="eyebrow">Category</span>
                <h3 class="item-title">A Really Good Pen</h3>
                <p class="item-description">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore.</p>
            </div>
            <div class="grid-item">
                <img src="https://placehold.co/600x400/EEE/333?text=Essential+2" alt="Essential Item 2" class="item-image">
                <span class="eyebrow">Category</span>
                <h3 class="item-title">Comfortable Shoes</h3>
                <p class="item-description">Dictum non consectetur a erat nam at lectus. Ultricies mi quis hendrerit dolor magna.</p>
            </div>
            <div class="grid-item">
                <img src="https://placehold.co/600x400/EEE/333?text=Essential+3" alt="Essential Item 3" class="item-image">
                <span class="eyebrow">Category</span>
                <h3 class="item-title">A Durable Tote Bag</h3>
                <p class="item-description">Massa tempor nec feugiat nisl pretium fusce id velit ut. Sed libero enim sed faucibus turpis in.</p>
            </div>
            <div class="grid-item">
                <img src="https://placehold.co/600x400/EEE/333?text=Essential+4" alt="Essential Item 4" class="item-image">
                <span class="eyebrow">Category</span>
                <h3 class="item-title">Quality Sunglasses</h3>
                <p class="item-description">Facilisi nullam vehicula ipsum a arcu cursus vitae congue. Accumsan lacus vel facilisis.</p>
            </div>
            <div class="grid-item">
                <img src="https://placehold.co/600x400/EEE/333?text=Essential+5" alt="Essential Item 5" class="item-image">
                <span class="eyebrow">Category</span>
                <h3 class="item-title">A Classic Watch</h3>
                <p class="item-description">Velit laoreet id donec ultrices tincidunt arcu non sodales. Viverra justo nec ultrices dui.</p>
            </div>
        </div>
    </section>

    <section id="imports" class="content-section">
        <h2 class="section-title">The Imports</h2>
        <div class="item-grid">
             <div class="grid-item">
                <img src="https://placehold.co/600x400/DDD/333?text=Import+1" alt="Import Item 1" class="item-image">
                <span class="eyebrow">From Japan</span>
                <h3 class="item-title">Artisanal Ceramics</h3>
                <p class="item-description">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore.</p>
            </div>
            <div class="grid-item">
                <img src="https://placehold.co/600x400/DDD/333?text=Import+2" alt="Import Item 2" class="item-image">
                <span class="eyebrow">From Italy</span>
                <h3 class="item-title">Leather Notebook</h3>
                <p class="item-description">Dictum non consectetur a erat nam at lectus. Ultricies mi quis hendrerit dolor magna.</p>
            </div>
            <div class="grid-item">
                <img src="https://placehold.co/600x400/DDD/333?text=Import+3" alt="Import Item 3" class="item-image">
                <span class="eyebrow">From Sweden</span>
                <h3 class="item-title">Minimalist Desk Lamp</h3>
                <p class="item-description">Massa tempor nec feugiat nisl pretium fusce id velit ut. Sed libero enim sed faucibus turpis in.</p>
            </div>
        </div>
    </section>

    <section id="deliveries" class="content-section placeholder-section"><h2 class="section-title">Next Deliveries</h2></section>
    <section id="cannoli" class="content-section placeholder-section"><h2 class="section-title">Cannoli</h2></section>
    <section id="coffee" class="content-section placeholder-section"><h2 class="section-title">Coffee Review</h2></section>
    <section id="games" class="content-section placeholder-section"><h2 class="section-title">Games</h2></section>

    
    <div id="signInModal" class="modal-overlay" aria-hidden="true">
        <div class="modal-content subscription-card">
            <button class="modal-close-btn">&times;</button>
            <h3 class="modal-header-text">SIGN IN</h3>
            <form id="signInForm" class="modal-form">
                <label for="signInEmail" class="form-label">EMAIL</label>
                <input type="email" id="signInEmail" class="form-input" placeholder="Enter your email" required>
                <label for="signInPassword" class="form-label">PASSWORD</label>
                <input type="password" id="signInPassword" class="form-input" placeholder="Enter your password" required>
                <button type="submit" class="modal-btn">SIGN IN</button>
            </form>
            <div class="modal-links">
                <button id="forgotPasswordBtn" class="modal-link-btn">Forgot password?</button>
                <button id="goToJoinBtnFromSignIn" class="modal-link-btn">Don't have an account? Join Community</button>
            </div>
        </div>
    </div>
    <div id="joinModal" class="modal-overlay" aria-hidden="true">
        <div class="modal-content subscription-card">
            <button class="modal-close-btn">&times;</button>
            <h2 id="modalTagline" class="modal-tagline"></h2>
            <form id="joinFormStep1" class="modal-form" data-step="1">
                <label for="joinEmail" class="form-label">EMAIL</label>
                <input type="email" id="joinEmail" class="form-input" placeholder="Enter your email" required>
                <button type="submit" class="modal-btn">NEXT</button>
            </form>
            <form id="joinFormStep2" class="modal-form hidden" data-step="2">
                <label for="joinName" class="form-label">NAME</label>
                <input type="text" id="joinName" class="form-input" placeholder="Enter your name" required>
                <label for="joinPassword" class="form-label">PASSWORD</label>
                <input type="password" id="joinPassword" class="form-input" placeholder="Create a password" required>
                <button type="submit" class="modal-btn">JOIN</button>
            </form>
            <div class="modal-links">
                <button id="goToSignInBtnFromJoin" class="modal-link-btn">Already have an account? Sign In</button>
            </div>
        </div>
    </div>
    <div id="toast-container"></div>
    <script>
        const header = document.querySelector('.main-header');
        const headerBranding = document.querySelector('.header-branding');
        const menuToggle = document.querySelector('.menu-toggle');
        const mobileNav = document.querySelector('.mobile-nav');
        const closeMenuBtn = document.querySelector('.close-menu-btn');
        window.addEventListener('scroll', () => {
            const scrollThreshold = headerBranding.offsetHeight;
            if (window.scrollY > scrollThreshold) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
        function toggleMenu() {
            const isOpen = mobileNav.classList.toggle('is-open');
            mobileNav.setAttribute('aria-hidden', !isOpen);
            document.body.classList.toggle('no-scroll', isOpen);
        }
        menuToggle.addEventListener('click', toggleMenu);
        closeMenuBtn.addEventListener('click', toggleMenu);
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBgCds3FfTRZtZaAQ0Ej6hfgPPMqeRy54s",
            authDomain: "newsletter-496de.firebaseapp.com",
            projectId: "newsletter-496de",
            storageBucket: "newsletter-496de.appspot.com",
            messagingSenderId: "524546319756",
            appId: "1:524546319756:web:947abcff220aec51aa22a9",
            measurementId: "G-B8LSKDYS99"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const signInModal = document.getElementById('signInModal');
        const joinModal = document.getElementById('joinModal');
        const modalCloseBtns = document.querySelectorAll('.modal-close-btn');
        const joinFormStep1 = document.getElementById('joinFormStep1');
        const joinFormStep2 = document.getElementById('joinFormStep2');
        const signInForm = document.getElementById('signInForm');
        const forgotPasswordBtn = document.getElementById('forgotPasswordBtn');
        const goToJoinBtnFromSignIn = document.getElementById('goToJoinBtnFromSignIn');
        const goToSignInBtnFromJoin = document.getElementById('goToSignInBtnFromJoin');
        const modalTagline = document.getElementById('modalTagline');
        const toastContainer = document.getElementById('toast-container');
        const mobileJoinLink = document.getElementById('mobileJoinLink');
        const mobileSignInLink = document.getElementById('mobileSignInLink');
        let typeInterval;
        let joinEmailValue = '';

        function showToast(message, type = 'info', duration = 4000) {
            const toast = document.createElement('div');
            toast.classList.add('toast', `toast-${type}`);
            toast.textContent = message;
            toastContainer.appendChild(toast);
            setTimeout(() => {
                toast.classList.add('toast-exit');
                toast.addEventListener('animationend', () => toast.remove());
            }, duration);
        }

        function typewriterEffect(element, text, speed, callback) {
            let i = 0;
            element.innerHTML = '';
            element.classList.add('typing-active');
            if (typeInterval) clearInterval(typeInterval);
            typeInterval = setInterval(() => {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                } else {
                    clearInterval(typeInterval);
                    element.classList.remove('typing-active');
                    if (callback) callback();
                }
            }, speed);
        }

        function openModal(modal) {
            modal.setAttribute('aria-hidden', 'false');
            modal.classList.add('is-open');
            document.body.classList.add('no-scroll');
            if (modal.id === 'joinModal') {
                const textToType = "For stories to tell at supper";
                setTimeout(() => {
                    typewriterEffect(modalTagline, textToType, 80, () => {
                        joinFormStep1.classList.add('form-visible');
                    });
                }, 300);
            }
        }

        function closeModal(modal) {
            modal.setAttribute('aria-hidden', 'true');
            modal.classList.remove('is-open');
            document.body.classList.remove('no-scroll');
            joinFormStep1.classList.remove('hidden');
            joinFormStep2.classList.add('hidden');
            joinFormStep1.reset();
            joinFormStep2.reset();
            if (typeInterval) clearInterval(typeInterval);
            if (modalTagline) {
                modalTagline.innerHTML = '';
                modalTagline.classList.remove('typing-active');
            }
            joinFormStep1.classList.remove('form-visible');
        }

        modalCloseBtns.forEach(btn => btn.addEventListener('click', (e) => closeModal(e.target.closest('.modal-overlay'))));
        signInModal.addEventListener('click', (e) => { if (e.target === signInModal) closeModal(signInModal) });
        joinModal.addEventListener('click', (e) => { if (e.target === joinModal) closeModal(joinModal) });
        goToJoinBtnFromSignIn.addEventListener('click', (e) => { e.preventDefault(); closeModal(signInModal); openModal(joinModal); });
        goToSignInBtnFromJoin.addEventListener('click', (e) => { e.preventDefault(); closeModal(joinModal); openModal(signInModal); });
        mobileJoinLink.addEventListener('click', (e) => { e.preventDefault(); openModal(joinModal); });
        mobileSignInLink.addEventListener('click', (e) => { e.preventDefault(); openModal(signInModal); });
        
        const signUp = async (email, password, name) => {
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                await setDoc(doc(db, "users", userCredential.user.uid), { email, name, createdAt: serverTimestamp() });
                showToast('Welcome to the community!', 'success');
                closeModal(joinModal);
            } catch (error) { showToast(error.message, 'error'); }
        };
        const signIn = async (email, password) => {
            try {
                await signInWithEmailAndPassword(auth, email, password);
                showToast('Successfully signed in!', 'success');
                closeModal(signInModal);
            } catch (error) { showToast(error.message, 'error'); }
        };
        const handleSignOut = async () => {
            try {
                await signOut(auth);
                showToast('You have been signed out.', 'info');
            } catch (error) { showToast(error.message, 'error'); }
        };
        const handleForgotPassword = async (email) => {
            if (!email) { showToast("Please enter an email to reset password.", 'error'); return; }
            try {
                await sendPasswordResetEmail(auth, email);
                showToast("Password reset email sent! Check your inbox.", 'info');
            } catch (error) { showToast(error.message, 'error'); }
        };
        
        signInForm.addEventListener('submit', (e) => { e.preventDefault(); signIn(signInForm.elements['signInEmail'].value, signInForm.elements['signInPassword'].value); });
        forgotPasswordBtn.addEventListener('click', (e) => { e.preventDefault(); handleForgotPassword(signInForm.elements['signInEmail'].value); });
        joinFormStep1.addEventListener('submit', (e) => {
            e.preventDefault();
            joinEmailValue = joinFormStep1.elements['joinEmail'].value;
            if (joinEmailValue) {
                joinFormStep1.classList.add('hidden');
                joinFormStep2.classList.remove('hidden');
            }
        });
        joinFormStep2.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = joinFormStep2.elements['joinName'].value;
            const password = joinFormStep2.elements['joinPassword'].value;
            if (joinEmailValue && name && password) {
                signUp(joinEmailValue, password, name);
            } else {
                showToast('Missing name or password.', 'error');
            }
        });
        
        onAuthStateChanged(auth, (user) => {
            const userAuthLinks = document.querySelector('.user-auth-links');
            if (user) {
                document.body.classList.add('logged-in');
                if (userAuthLinks) {
                    userAuthLinks.innerHTML = `<a href="#" class="btn" id="signOutBtn">SIGN OUT</a>`;
                    document.getElementById('signOutBtn').addEventListener('click', (e) => { e.preventDefault(); handleSignOut(); });
                }
                getUserProfile(user.uid);
                closeModal(signInModal);
                closeModal(joinModal);
            } else {
                document.body.classList.remove('logged-in');
                if (userAuthLinks) {
                    userAuthLinks.innerHTML = `<a href="#" class="nav-link" id="signInLink">SIGN IN</a><a href="#" class="btn btn-primary" id="joinLink">JOIN COMMUNITY</a>`;
                    document.getElementById('signInLink').addEventListener('click', (e) => { e.preventDefault(); openModal(signInModal); });
                    document.getElementById('joinLink').addEventListener('click', (e) => { e.preventDefault(); openModal(joinModal); });
                }
            }
        });

        const getUserProfile = async (userId) => {
            if (!userId) return null;
            const docSnap = await getDoc(doc(db, 'users', userId));
            if (docSnap.exists()) { console.log("User profile data:", docSnap.data()); } 
            else { console.log("No such user document!"); }
        };

        const navLinks = document.querySelectorAll('.main-nav a');
        const sections = document.querySelectorAll('main, .content-section');
        const observerOptions = {
            root: null,
            rootMargin: '-40% 0px -60% 0px',
            threshold: 0
        };
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.getAttribute('id');
                    navLinks.forEach(link => {
                        link.classList.remove('active-link');
                        if (link.getAttribute('href') === `#${id}`) {
                            link.classList.add('active-link');
                        }
                    });
                }
            });
        }, observerOptions);
        sections.forEach(section => observer.observe(section));
    </script>
</body>
</html>

